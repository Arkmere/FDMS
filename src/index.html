<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Vectair FDMS Lite</title>
    <link rel="stylesheet" href="./css/vectair.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="header">
        <div class="header-left">
          <div class="va-logo-box">VA</div>
          <div>
            <div class="va-title-main">Vectair FDMS Lite</div>
            <div class="va-title-sub">EGOW / RAF Woodvale — Demo</div>
          </div>
        </div>
        <div class="header-right">
          <div><strong>UTC</strong></div>
          <div id="utcClock">--:--:--</div>
        </div>
      </header>

      <nav class="nav-bar">
        <div class="nav-tabs" role="tablist">
          <button class="nav-tab active" data-tab="tab-live">Live Board</button>
          <button class="nav-tab" data-tab="tab-history">History</button>
          <button class="nav-tab" data-tab="tab-reports">Reports</button>
          <button class="nav-tab" data-tab="tab-vkb">VKB Lookup</button>
          <button class="nav-tab" data-tab="tab-admin">Admin</button>
        </div>
      </nav>

      <main class="page-body">
        <!-- LIVE -->
        <section id="tab-live" class="tab-panel">
          <div class="page-title">Live Board</div>
          <div class="page-subtitle">Administrative strip-style movement list (not a controlling system).</div>

          <div class="panel">
            <div class="toolbar">
              <div class="toolbar-left">
                <select class="field field-select" id="statusFilter">
                  <option value="planned_active" selected>Planned & Active</option>
                  <option value="active">Active only</option>
                  <option value="all">All</option>
                </select>

                <input
                  class="field field-search-global"
                  id="globalSearch"
                  type="search"
                  placeholder="Search callsign, reg, type, route, codes…"
                />
              </div>

              <div class="toolbar-right">
                <button class="btn btn-ft btn-ft-loc" id="btnNewLoc" type="button">New LOC</button>
                <button class="btn btn-ft btn-ft-dep" id="btnNewDep" type="button">New DEP</button>
                <button class="btn btn-ft btn-ft-arr" id="btnNewArr" type="button">New ARR</button>
                <button class="btn btn-ft btn-ft-ovr" id="btnNewOvr" type="button">New OVR</button>
              </div>
            </div>

            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th style="width: 14px"></th>
                    <th>Callsign</th>
                    <th>Reg / Type / WTC</th>
                    <th>Route</th>
                    <th>Times</th>
                    <th>Activity</th>
                    <th style="width: 250px; text-align: right">Actions</th>
                  </tr>
                  <tr class="filter-row">
                    <th></th>
                    <th><input id="colFilterCallsign" placeholder="Filter callsign…" /></th>
                    <th><input id="colFilterReg" placeholder="Filter reg…" /></th>
                    <th><input id="colFilterRoute" placeholder="Filter route…" /></th>
                    <th></th>
                    <th></th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="liveBody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- HISTORY -->
        <section id="tab-history" class="tab-panel hidden">
          <div class="page-title">History</div>
          <div class="page-subtitle">Completed and cancelled movements (session).</div>

          <div class="panel">
            <div class="history-actions">
              <button class="btn btn-secondary" id="btnExportHistoryCsv" type="button">
                Export History as CSV
              </button>
            </div>

            <div class="table-container">
              <table id="historyTable">
                <thead>
                  <tr>
                    <th style="width: 14px"></th>
                    <th data-sort="callsign">Callsign</th>
                    <th data-sort="regtype">Reg / Type / WTC</th>
                    <th data-sort="route">Route</th>
                    <th data-sort="time">Times</th>
                    <th data-sort="activity">Activity</th>
                    <th data-sort="status">Status</th>
                  </tr>
                </thead>
                <tbody id="historyBody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- REPORTS -->
        <section id="tab-reports" class="tab-panel hidden">
          <div class="page-title">Reports</div>
          <div class="page-subtitle">Basic session totals (no date slicing yet).</div>

          <div class="panel">
            <div class="reports-grid" id="reportsSummary"></div>
          </div>
        </section>

        <!-- VKB -->
        <section id="tab-vkb" class="tab-panel hidden">
          <div class="page-title">VKB Lookup</div>
          <div class="page-subtitle">Static demo lookup (in-memory) for callsigns, locations, types.</div>

          <div class="panel">
            <div class="lookup-toolbar">
              <input class="field field-search-global" id="vkbSearch" type="search" placeholder="Search VKB demo…" />
              <div class="lookup-hint">Demo dataset only. Later: backed by Vectair KB.</div>
            </div>

            <div class="table-container">
              <table>
                <thead>
                  <tr>
                    <th>Kind</th>
                    <th>Code</th>
                    <th>Label</th>
                    <th>Details</th>
                    <th style="width: 110px; text-align: right">Actions</th>
                  </tr>
                </thead>
                <tbody id="vkbBody"></tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- ADMIN -->
        <section id="tab-admin" class="tab-panel hidden">
          <div class="page-title">Admin</div>
          <div class="page-subtitle">
            LocalStorage persistence is enabled. Reset restores demo seed (and overwrites local session data).
          </div>

          <!-- Init Status -->
          <div class="panel">
            <h3>System Status</h3>
            <div id="initStatus" style="padding: 8px; background: #e8f5e9; border-left: 4px solid #4caf50; margin-bottom: 12px;">
              <strong>⏳ Initialising...</strong>
            </div>
          </div>

          <!-- Diagnostics Panel -->
          <div class="panel">
            <h3>Diagnostics</h3>
            <table style="width: 100%; border-collapse: collapse;">
              <tr>
                <td style="padding: 6px; font-weight: bold; width: 200px;">Last Init Time:</td>
                <td id="diagInitTime" style="padding: 6px; font-family: monospace;">—</td>
              </tr>
              <tr>
                <td style="padding: 6px; font-weight: bold;">Last Render Time:</td>
                <td id="diagRenderTime" style="padding: 6px; font-family: monospace;">—</td>
              </tr>
              <tr>
                <td style="padding: 6px; font-weight: bold;">Storage Key:</td>
                <td id="diagStorageKey" style="padding: 6px; font-family: monospace;">—</td>
              </tr>
              <tr>
                <td style="padding: 6px; font-weight: bold;">Movement Count:</td>
                <td id="diagMovementCount" style="padding: 6px; font-family: monospace;">—</td>
              </tr>
              <tr>
                <td style="padding: 6px; font-weight: bold;">Last Error:</td>
                <td id="diagLastError" style="padding: 6px; font-family: monospace; color: #d32f2f;">None</td>
              </tr>
            </table>
          </div>

          <!-- Session Management -->
          <div class="panel">
            <h3>Session Management</h3>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <button class="btn btn-primary" id="btnExportSession" type="button">Export Session JSON</button>
              <button class="btn btn-primary" id="btnImportSession" type="button">Import Session JSON</button>
              <button class="btn btn-secondary" id="btnResetDemo" type="button">Reset to Demo Data</button>
            </div>
            <input type="file" id="importFileInput" accept=".json" style="display: none;" />
          </div>

          <!-- Configuration -->
          <div class="panel">
            <h3>Configuration</h3>
            <div style="font-size: 11px; color: #666; margin-bottom: 12px;">
              Default time offsets for new movements (minutes from current time):
            </div>

            <table style="width: 100%; border-collapse: collapse; margin-bottom: 12px;">
              <thead>
                <tr style="border-bottom: 1px solid #ddd;">
                  <th style="text-align: left; padding: 6px; font-weight: bold;">Flight Type</th>
                  <th style="text-align: left; padding: 6px; font-weight: bold;">Offset (minutes)</th>
                  <th style="text-align: left; padding: 6px; font-weight: bold;">Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding: 6px; font-weight: bold;">DEP</td>
                  <td style="padding: 6px;">
                    <input
                      type="number"
                      id="configDepOffset"
                      min="0"
                      max="180"
                      style="width: 80px; padding: 4px; border: 1px solid #ccc; border-radius: 3px;"
                    />
                  </td>
                  <td style="padding: 6px; font-size: 11px; color: #666;">ETD defaults to now + this</td>
                </tr>
                <tr>
                  <td style="padding: 6px; font-weight: bold;">ARR</td>
                  <td style="padding: 6px;">
                    <input
                      type="number"
                      id="configArrOffset"
                      min="0"
                      max="180"
                      style="width: 80px; padding: 4px; border: 1px solid #ccc; border-radius: 3px;"
                    />
                  </td>
                  <td style="padding: 6px; font-size: 11px; color: #666;">ETA defaults to now + this</td>
                </tr>
                <tr>
                  <td style="padding: 6px; font-weight: bold;">LOC</td>
                  <td style="padding: 6px;">
                    <input
                      type="number"
                      id="configLocOffset"
                      min="0"
                      max="180"
                      style="width: 80px; padding: 4px; border: 1px solid #ccc; border-radius: 3px;"
                    />
                  </td>
                  <td style="padding: 6px; font-size: 11px; color: #666;">ETD & ETA default to now + this</td>
                </tr>
                <tr>
                  <td style="padding: 6px; font-weight: bold;">OVR</td>
                  <td style="padding: 6px;">
                    <input
                      type="number"
                      id="configOvrOffset"
                      min="0"
                      max="180"
                      style="width: 80px; padding: 4px; border: 1px solid #ccc; border-radius: 3px;"
                    />
                  </td>
                  <td style="padding: 6px; font-size: 11px; color: #666;">ECT defaults to now + this</td>
                </tr>
              </tbody>
            </table>

            <button class="btn btn-primary" id="btnSaveConfig" type="button">Save Configuration</button>
          </div>
        </section>
      </main>
    </div>

<div id="modalRoot"></div>

    <script type="module" src="./js/app.js"></script>
  </body>
</html>
